<!DOCTYPE html>
<html lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="description" content="低调做人，高调做事。">


    <meta name="keywords" content="技术博客/Android/Linux">


<title>View的三种移动方式 | KCrason&#39;s Blog</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


</head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">KCrason&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/categories">Categories</a>
                
                    <a class="menu-item" href="/tags">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>

        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">KCrason&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/categories">Categories</a>
                
                    <a class="menu-item" href="/tags">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">View的三种移动方式</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">KCrason</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">September 13, 2016&nbsp;&nbsp;16:22:35</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/categories/Android/">Android</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <p>Android开发中，View一直是Android开发人员的一块心病，一方面想要进阶，一方面又害怕进阶，可以说Android的View是进阶路上的最大绊脚石，因为它涉及的东西太多了，比如本次我们此次要写的View移动，另外还包括View的触摸事件的传递，创建自定义View，这些都是极其重要且不得不面对的难题。但是无论如何，现在不克服的困难将来就会被困难克服。</p>
<p>啊，真是一波好鸡汤…</p>
<hr>
<h2 id="Let’s-begin！"><a href="#Let’s-begin！" class="headerlink" title="####Let’s begin！"></a>####Let’s begin！</h2><p>在此之前，我们还是先了解Android坐标系的定义规则以及View的一些位置参数。<br><img src="http://upload-images.jianshu.io/upload_images/1860505-78ac98c159710026.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Android坐标系"></p>
<ul>
<li>View的位置及大小是由四个参数决定，即left、top、right、bottom，并且这四个参数都是相对于其父View的。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int width = right-left;</span><br><span class="line">int height = bottom-top;</span><br></pre></td></tr></table></figure>

<p>在Activity中布局完成后，我们可以通过View一些方法获取这些参数信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//left,top,right,bottom值的获取</span><br><span class="line">int left = getLeft();</span><br><span class="line">int top = getTop();</span><br><span class="line">int right = getRight();</span><br><span class="line">int bottom = getBottom();</span><br></pre></td></tr></table></figure>

<ul>
<li>另外Android 3.0以后加入x，y，translationX，translationY等参数。（x,y）表示为View在ViewGroup中左上角的x,y的值，translationX，translationY在用于平移一个View。默认是都为0，在调用了View的setTranslationX()/setTranslationY()之后发生改变。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//x,y,translationX,translationY参数的获取</span><br><span class="line">int x = getX();</span><br><span class="line">int y = getY();</span><br><span class="line">int translationX = getTranslationX();</span><br><span class="line">int translationY = getTranslationY();</span><br></pre></td></tr></table></figure>

<p>PS：调用View的setTranslationX()和setTranslationY()方法虽然可以使得View平移指定距离，但是这一过程是瞬间完成的。为了使View的移动使得更为平滑，因此可以使用View的属性动画来指定translationX和translationY。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ObjectAnimator valueAnimator = ObjectAnimator.ofFloat(textView, &quot;translationX&quot;, 200);</span><br><span class="line">valueAnimator.setDuration(2000);</span><br><span class="line">valueAnimator.start();</span><br></pre></td></tr></table></figure>

<p>另外，如果给View设置setTranslationX()和setTranslationY()后，如果设置的值没有发生变化，那么其只会移动一次，即首次指定的移动距离。查看源码后我们发现原因：原来在设置值之后其会将设置进去的值和当前的translationX，translationY进行对比，不一致时才进行移动。<br><img src="http://upload-images.jianshu.io/upload_images/1860505-42ddbbb6a92e00c6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"></p>
<p>了解了View的一些基本参数之后，我们看关于View的三种移动方式。</p>
<p>#####一、使用Android系统提供的scrollTo()/scrollBy()方法实现View的移动。</p>
<hr>
<ul>
<li><p>不管是scrollTo()还是scrollBy()其移动的本质都是View/ViewGroup中的内容。并且其移动的过程是瞬间完成的，因此，为了实现更好的移动效果，他需要与Scroller类结合使用。另外，它不同于上面的Translation，移动的是View本身，这一点需要好好理解一下。</p>
</li>
<li><p>scrollTo()和scrollBy()都是View中的方法，<strong>不是Scroller中的方法</strong>，但是控制View的平滑移动与Scroller类密不可分。</p>
</li>
</ul>
<p>*<em>scrollTo() : *</em>指是的移动的绝对位置，如果位置没有变化，多次调用则不会起作用。<br><img src="http://upload-images.jianshu.io/upload_images/1860505-75e31cba0036c0d0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="scrollTo移动过程示意图"><br>*<em>scrollBy() : *</em>其本质依然是调用的scrollTo()，指的的移动当前位置的相对距离（每次都是先将当前的位置和设置的距离相加之和调用scrollTo()，这样如果你多次调用，你就会发现其每次都会移动一段距离，这是和scrollTo()的本质区别）</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1860505-f82680e4cbc704ef.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="scrollBy移动过程示意图"></p>
<p>PS:关于上面两张图，其实一直以来，我自己都没完全搞明白什么相对绝对，所以两张手图可能会让人更容易理解。还有就是scrollTo()和scrollBy()移动方向问题，上面我们已经画过Android的坐标系，x轴左→右为正，y轴从上→下为正。但是这并不适用于scrollTo和scrollBy，scrollTo和scrollBy刚好相反，即x轴左→右为负，y轴从上→下为负，简直是有点坑爹啊。O__O “…</p>
<ul>
<li>Scroller类分析：而为什么使用Scroller类中的方法可以对View/ViewGroup的内容进行移动呢？下面我们试着分析一下。</li>
</ul>
<p><strong>首先</strong><br>我们创建一个Scroller类的对象mScroller。<br><strong>然后</strong><br>要使View在规定的时间中移动到指定的位置，我们会调用startScroll()方法，startScroll()是Scroller类中的方法，另外Scroller类中还有一个filing()方法也是很常用的，它主要是处理平滑的移动，一般营造滑动之后的惯性效果，使得View的移动更逼真。下面我们看startScroll()的源码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//其接收四个/五个参数。如果duration不设置，则为默认。这四个参数都不难理解，这里不再做解释。</span><br><span class="line"> public void startScroll(int startX, int startY, int dx, int dy, int duration) &#123;   </span><br><span class="line">    ...</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>而一般我们调用这个方法后都要去调View的 invalidate()，这个方法可以触发View的draw()方法。而draw()中调用了 computeScroll()，源码中我们发现computeScroll()是个空方法，这也是为什么我们需要重写 computeScroll()方法的原因。因为正在的移动操作就是在computeScroll()中进行的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public void computeScroll() &#123;</span><br><span class="line">    if (mScroller.computeScrollOffset()) &#123;</span><br><span class="line">        scrollTo(mScroller.getCurrX(), mScroller.getCurrY());</span><br><span class="line">        //必须调用View的postInvalidate()/invalidate()，如果不加会导致View的移动只会第一帧。</span><br><span class="line">        postInvalidate();</span><br><span class="line">    &#125;</span><br><span class="line">    super.computeScroll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面我们看到Scroller类中还有一个computeScrollOffset()方法，它又是干啥的呢？它的主要作用就是判断mCurrX，和mCurrY是否有改变，有则返回true，无则返回false。通过这个方法的判断可以指点是否需要持续的调用scrollTo()去移动View。这里再给出一个示例，使用scrollTo()让View跟着手指移动：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">public class CuView extends LinearLayout &#123;</span><br><span class="line"></span><br><span class="line">    private float mStartX;</span><br><span class="line">    private float mStartY;</span><br><span class="line">    private Scroller mScroller;</span><br><span class="line">    /**</span><br><span class="line">     * 第一次滑动是否完成</span><br><span class="line">     */</span><br><span class="line">    private boolean isFirstFinish;</span><br><span class="line"></span><br><span class="line">    public CuView(Context context) &#123;</span><br><span class="line">        super(context);</span><br><span class="line">        init(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public CuView(Context context, AttributeSet attrs) &#123;</span><br><span class="line">        super(context, attrs);</span><br><span class="line">        init(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void init(Context context) &#123;</span><br><span class="line">        mScroller = new Scroller(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public CuView(Context context, AttributeSet attrs, int defStyleAttr) &#123;</span><br><span class="line">        super(context, attrs, defStyleAttr);</span><br><span class="line">        init(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @TargetApi(Build.VERSION_CODES.LOLLIPOP)</span><br><span class="line">    public CuView(Context context, AttributeSet attrs, int defStyleAttr, int defStyleRes) &#123;</span><br><span class="line">        super(context, attrs, defStyleAttr, defStyleRes);</span><br><span class="line">        init(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 让View跟着你的手指走吧</span><br><span class="line">     * @param event</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public boolean onTouchEvent(MotionEvent event) &#123;</span><br><span class="line">        int action = event.getAction();</span><br><span class="line">        switch (action) &#123;</span><br><span class="line">            case MotionEvent.ACTION_DOWN:</span><br><span class="line">                /**</span><br><span class="line">                 * 第一次移动完成后，我们不需要再去拿开始的位置了，否则造成View重新移动的最起始的位置。</span><br><span class="line">                 */</span><br><span class="line">                if (!isFirstFinish) &#123;</span><br><span class="line">                    mStartX = event.getRawX();</span><br><span class="line">                    mStartY = event.getRawY();</span><br><span class="line">                &#125;</span><br><span class="line">                break;</span><br><span class="line">            case MotionEvent.ACTION_MOVE:</span><br><span class="line">                scrollTo((int) (mStartX - event.getRawX()), (int) (mStartY - event.getRawY()));</span><br><span class="line">                break;</span><br><span class="line">            case MotionEvent.ACTION_UP:</span><br><span class="line">                //第一次移动完成</span><br><span class="line">                isFirstFinish = true;</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 测试startScroll</span><br><span class="line">     */</span><br><span class="line">    public void startScroll() &#123;</span><br><span class="line">        /**</span><br><span class="line">         * 注意Scroller移动方向，</span><br><span class="line">         */</span><br><span class="line">        mScroller.startScroll(20, 20, -500, -500, 5000);</span><br><span class="line">        invalidate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void computeScroll() &#123;</span><br><span class="line">        if (mScroller.computeScrollOffset()) &#123;</span><br><span class="line">            scrollTo(mScroller.getCurrX(), mScroller.getCurrY());</span><br><span class="line">            invalidate();</span><br><span class="line">        &#125;</span><br><span class="line">        super.computeScroll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>#####二、使用动画实现View的移动。</p>
<ul>
<li>这里包括View的Tween Animation/Frame Animation，以及3.0之后加入的Property Animation。其移动的是View的一个映像，View本身的位置及大小并没有发生任何改变。</li>
</ul>
<p>#####三、设置View的LayoutParams来移动View</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LinearLayout.LayoutParams layoutParams = (LinearLayout.LayoutParams) textView.getLayoutParams();</span><br><span class="line">layoutParams.leftMargin = 50;</span><br><span class="line">textView.requestLayout();</span><br></pre></td></tr></table></figure>


        </div>

        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/View/"># View</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2016/10/18/css margin属性理解与使用/">css margin属性理解与使用</a>
            
            
            <a class="next" rel="next" href="/2016/09/02/Android发布 Library到JCenter/">Android发布Library到JCenter</a>
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© KCrason | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>
</html>
