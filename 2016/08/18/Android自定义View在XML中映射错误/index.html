<!DOCTYPE html>
<html lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="description" content="低调做人，高调做事。">


    <meta name="keywords" content="技术博客/Android/Linux">


<title>Android自定义View在XML中映射错误 | KCrason&#39;s Blog</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


</head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">KCrason&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/categories">Categories</a>
                
                    <a class="menu-item" href="/tags">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>

        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">KCrason&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/categories">Categories</a>
                
                    <a class="menu-item" href="/tags">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">Android自定义View在XML中映射错误</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">KCrason</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">August 18, 2016&nbsp;&nbsp;10:12:29</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/categories/Android/">Android</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <p>Android开发中我们经常会遇到自定义View地址映射错误的情况，现将遇到的情况做下总结：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//Android Studio的异常信息</span><br><span class="line">Error inflating class</span><br></pre></td></tr></table></figure>

<p>1、直接像下面这样，包名所对应的地址错误：在XML中我们地址是com.kcrason.kcircle.widget.HaoRecyclerView，而在实际的项目包名中可能为com.kcrason.kcircle.HaoRecyclerView，从而导致异常信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;com.kcrason.kcircle.widget.HaoRecyclerView</span><br><span class="line">  android:id=&quot;@+id/rv_list&quot;</span><br><span class="line">  android:listDivider=&quot;@color/gray&quot;</span><br><span class="line">  android:layout_width=&quot;match_parent&quot;</span><br><span class="line">  android:layout_height=&quot;match_parent&quot;</span><br><span class="line">&gt;&lt;/com.kcrason.kcircle.widget.HaoRecyclerView&gt;</span><br></pre></td></tr></table></figure>

<p>2、包含include标签的XML，且include中的View中含有错误的自定义View的地址，如下面所示，include标签中的include_view有错误，一般最容易让人忽略。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;include layout=&quot;@layout/include_view&quot;&gt;&lt;/include&gt;</span><br><span class="line"></span><br><span class="line">&lt;com.kcrason.kcircle.HaoRecyclerView</span><br><span class="line">   android:id=&quot;@+id/rv_list&quot;</span><br><span class="line">   android:listDivider=&quot;@color/gray&quot;</span><br><span class="line">   android:layout_width=&quot;match_parent&quot;</span><br><span class="line">   android:layout_height=&quot;match_parent&quot;</span><br><span class="line">&gt;&lt;/com.kcrason.kcircle.HaoRecyclerView&gt;</span><br></pre></td></tr></table></figure>

<p>3、在Android系统进行XML映射时出现错误，一般来说，即自定义View的初始化操作有问题。通常我们在自定义View时都是构建一个 <strong>init()</strong> 方法进行一些初始化操作，而正是这些操作造成了一个隐患。因为如果在解析XML中的自定义View不成功时，或者说在这一过程出现了异常时，所抛出的异常信息依然是 <strong>Error inflating class</strong> ，这是一个非常隐蔽的错误，一般而言，我们不通过断点调试，很难发现到底出了什么问题。</p>
<p>PS:我们在构建自定义View时设置View的背景颜色-</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">private void init()&#123;</span><br><span class="line">    //此处省略</span><br><span class="line">    ...</span><br><span class="line">    setBackground(context.getDrawable(R.color.white));</span><br><span class="line">    //此处省略</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>乍一看好像没啥问题，确实，这段代码在Android 5.0及以上的系统上跑没有任何问题，但是在Android 5.0以下就会直接抛出上面的异常信息。首先  <strong>setBackground()</strong> 只在API 16及以上才支持，同时 <strong>context.getDrawable()</strong> 更是LOLLIPOP才支持的方法。而就目前而言，Android studio自定推荐的最低项目版本都是在API 15，结果可想而知。这样写就不再有问题，虽然会提示我们该方法已经过期，但是没关系。当然你也可以通过版本判断，不同版本下使用不同的方法，从而解决这一问题。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setBackgroundDrawable(context.getResources().getDrawable(R.color.white));</span><br></pre></td></tr></table></figure>

<p>当然，这里所讲的并不是为了说明版本的适配问题，而是为了更清楚的阐述关于自定义View所造成的一些问题。</p>
<p>4、自定义View时，构造方法有问题。这个一般很少出现。</p>
<p>5、自定义View为内部类时，需要声明为static才能inflate。由于没有遇到过，这里引用<a href="http://blog.csdn.net/soliuyong/article/details/6773059" target="_blank" rel="noopener">http://blog.csdn.net/soliuyong/article/details/6773059</a> 的博客。</p>
<p>PS:关于自定义组件，还需要注意的一点是，如果时内部类，这个类就不能作为layout中的节点的名称，而必须用view作为节点名，然后加入一个class属性，值为该内部类的引用，比如launcher中又下面这样一个例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;view  </span><br><span class="line">    class=&quot;com.android.launcher2.AllApps2D$HomeButton&quot;  </span><br><span class="line">    android:id=&quot;@+id/all_apps_2d_home&quot;  </span><br><span class="line">    android:tag=&quot;all_apps_2d_home&quot;  </span><br><span class="line">    android:src=&quot;@drawable/home_button&quot;  </span><br><span class="line">    android:background=&quot;#FF000000&quot;  </span><br><span class="line">    android:layout_centerHorizontal=&quot;true&quot;  </span><br><span class="line">    android:layout_alignParentBottom=&quot;true&quot;  </span><br><span class="line">    android:layout_width=&quot;wrap_content&quot;  </span><br><span class="line">    android:layout_height=&quot;@dimen/button_bar_height&quot;  </span><br><span class="line">    android:nextFocusUp=&quot;@+id/all_apps_2d_grid&quot;  </span><br><span class="line">    android:nextFocusDown=&quot;@null&quot;  </span><br><span class="line">    android:nextFocusLeft=&quot;@null&quot;  </span><br><span class="line">    android:nextFocusRight=&quot;@null&quot;  </span><br><span class="line">    /&gt;</span><br></pre></td></tr></table></figure>


        </div>

        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/Xml/"># Xml</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2016/08/18/Android SQLite/">Android SQLite</a>
            
            
            <a class="next" rel="next" href="/2016/08/17/List分组请求数据/">List分组请求数据</a>
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© KCrason | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>
</html>
